# 13 — 文件清单文档

---

## 1. 概述

本文档列出 PNNE 项目中所有源文件的职责和实现要点，帮助开发者快速了解项目结构。

---

## 2. 核心模块 (core/)

### 2.1 基础数据模型 (core/base/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `node.py` | 节点基类 | - 属性管理<br>- 引脚管理<br>- 前向/反向传播接口<br>- 序列化 |
| `pin.py` | 引脚类 | - 数据类型检查<br>- 连接管理<br>- 形状推导 |
| `connection.py` | 连接类 | - 连接验证<br>- 数据传递<br>- 状态管理 |
| `node_graph.py` | 节点图管理器 | - 节点增删<br>- 拓扑排序<br>- 子图支持 |
| `path_manager.py` | 路径管理器 | - 路径解析<br>- 节点查找<br>- 路径验证 |
| `node_registry.py` | 节点注册表 | - 节点类注册<br>- 节点工厂集成 |
| `node_factory.py` | 节点工厂 | - 节点创建<br>- 类型查找 |

### 2.2 节点实现 (core/nodes/)

#### 神经网络层节点 (core/nodes/nn/)

| 文件 | 包含节点 | 说明 |
|------|---------|------|
| `linear_node.py` | LinearNode | 全连接层 |
| `conv_nodes.py` | Conv1dNode, Conv2dNode, Conv3dNode | 卷积层 |
| `pool_nodes.py` | MaxPool2dNode, AvgPool2dNode | 池化层 |
| `activation_nodes.py` | ReLUNode, SigmoidNode, TanhNode, SoftmaxNode, LeakyReLUNode, ELUNode, GELUNode | 激活函数 |
| `norm_nodes.py` | BatchNorm2dNode, LayerNormNode, GroupNormNode, InstanceNormNode | 归一化层 |
| `dropout_node.py` | DropoutNode, Dropout2dNode | Dropout层 |
| `rnn_nodes.py` | RNNNode, LSTMNode, GRUNode | 循环神经网络 |
| `transformer_nodes.py` | TransformerEncoderNode, TransformerDecoderNode | Transformer |
| `loss_nodes.py` | CrossEntropyLossNode, MSELossNode, BCELossNode, L1LossNode | 损失函数 |
| `optimizer_nodes.py` | SGDNode, AdamNode, AdamWNode, RMSPropNode | 优化器 |

#### 数据节点 (core/nodes/data/)

| 文件 | 包含节点 | 说明 |
|------|---------|------|
| `image_loader_node.py` | ImageLoaderNode | 图片加载 |
| `text_loader_node.py` | TextLoaderNode | 文本加载 |
| `obj_loader_node.py` | OBJLoaderNode | 3D模型加载 |
| `csv_loader_node.py` | CSVLoaderNode | CSV文件加载 |
| `dataset_node.py` | DatasetNode | Dataset包装 |
| `dataloader_node.py` | DataLoaderNode | DataLoader调度 |

#### 逻辑控制节点 (core/nodes/logic/)

| 文件 | 包含节点 | 说明 |
|------|---------|------|
| `foreach_begin_node.py` | ForEachBeginNode | 循环开始 |
| `foreach_end_node.py` | ForEachEndNode | 循环结束 |
| `switch_node.py` | SwitchNode | 条件分支 |
| `merge_node.py` | MergeNode | 合并节点 |
| `null_node.py` | NullNode | 空节点（透传） |

#### 子网节点 (core/nodes/subnet/)

| 文件 | 包含节点 | 说明 |
|------|---------|------|
| `subnet_node.py` | SubnetNode | 子网容器 |
| `subnet_input_node.py` | SubnetInputNode | 子网输入 |
| `subnet_output_node.py` | SubnetOutputNode | 子网输出 |

#### 脚本节点 (core/nodes/script/)

| 文件 | 包含节点 | 说明 |
|------|---------|------|
| `python_node.py` | PythonNode | Python脚本执行 |

#### 上下文根节点 (core/nodes/context/)

| 文件 | 包含节点 | 说明 |
|------|---------|------|
| `obj_context_node.py` | ObjContextNode | /obj/ 根节点 |
| `vis_context_node.py` | VisContextNode | /vis/ 根节点 |
| `train_context_node.py` | TrainContextNode | /train/ 根节点 |

### 2.3 执行引擎 (core/engine/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `graph_executor.py` | 图执行器 | - 拓扑排序<br>- 节点调度<br>- 数据流管理 |
| `torch_compiler.py` | 模型编译器 | - 节点图→nn.Module<br>- DynamicModule生成<br>- 模型导出 |
| `training_engine.py` | 训练引擎 | - 训练循环<br>- 检查点管理<br>- 信号发送 |
| `inference_engine.py` | 推理引擎 | - 模型推理<br>- 批量处理 |

### 2.4 表达式引擎 (core/expressions/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `tokenizer.py` | 词法分析器 | - 标记识别<br>- 引用解析 |
| `parser.py` | 语法分析器 | - AST构建<br>- 优先级处理 |
| `ast_nodes.py` | AST节点定义 | - 字面量<br>- 运算符<br>- 函数调用 |
| `evaluator.py` | 求值器 | - AST遍历<br>- 上下文管理 |
| `functions.py` | 内置函数库 | - 数学函数<br>- 字符串函数<br>- 张量函数 |

### 2.5 序列化系统 (core/serialization/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `serializer.py` | 序列化器 | - 节点序列化<br>- 图序列化 |
| `deserializer.py` | 反序列化器 | - JSON→对象<br>- 依赖解析 |
| `project_manager.py` | 项目管理器 | - 项目保存/加载<br>- 自动保存 |
| `clipboard.py` | 剪贴板管理 | - 节点复制/粘贴 |
| `format_version.py` | 格式版本管理 | - 版本迁移 |

### 2.6 撤销/重做系统 (core/undo/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `command.py` | 命令基类 | - 执行/撤销接口 |
| `undo_stack.py` | 撤销栈 | - 命令管理<br>- 历史记录 |
| `commands/node_commands.py` | 节点命令 | - 创建/删除/移动节点 |
| `commands/connection_commands.py` | 连接命令 | - 创建/删除连接 |
| `commands/property_commands.py` | 属性命令 | - 属性修改 |

---

## 3. 用户界面模块 (ui/)

### 3.1 主窗口 (ui/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `main_window.py` | 主窗口 | - 布局管理<br>- 菜单/工具栏<br>- 信号连接 |

### 3.2 图形系统 (ui/graphics/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `node_graphics_scene.py` | 图形场景 | - 场景管理<br>- 碰撞检测 |
| `node_graphics_view.py` | 图形视图 | - 缩放/平移<br>- 交互处理<br>- 状态机 |
| `node_graphics_item.py` | 节点图形项 | - 节点渲染<br>- 拖拽处理 |
| `pin_graphics_item.py` | 引脚图形项 | - 引脚渲染<br>- 悬停显示 |
| `connection_graphics_item.py` | 连接线图形项 | - 贝塞尔曲线<br>- 动态更新 |
| `node_breadcrumb.py` | 路径导航条 | - 路径显示<br>- 点击导航 |
| `minimap_widget.py` | 小地图 | - 缩略图渲染<br>- 视口跳转 |
| `context_menu.py` | 上下文菜单 | - 节点创建菜单<br>- TAB快捷菜单 |

### 3.3 面板 (ui/panels/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `data_viewer_panel.py` | 数据可视化面板 | - 权重分布<br>- 特征图<br>- 梯度可视化 |
| `properties_panel.py` | 属性面板 | - 参数编辑<br>- 表达式编辑 |
| `node_library_panel.py` | 节点库面板 | - 节点分类<br>- 搜索过滤 |
| `detail_panel.py` | Detail面板 | - Detail数据展示 |
| `console_panel.py` | Python控制台 | - 交互式控制台 |
| `training_monitor_panel.py` | 训练监控面板 | - 实时曲线<br>- 日志显示 |

### 3.4 自定义控件 (ui/widgets/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `parameter_widgets.py` | 参数编辑控件 | - Int/Float/String/Bool/Enum/Color控件 |
| `expression_editor.py` | 表达式编辑器 | - 语法高亮<br>- 自动补全 |
| `code_editor.py` | 代码编辑器 | - Python语法高亮<br>- 代码补全 |
| `tensor_viewer.py` | 张量查看器 | - 张量摘要<br>- 数值显示 |
| `matrix_viewer.py` | 矩阵查看器 | - 矩阵可视化 |
| `image_viewer.py` | 图片查看器 | - 图片显示<br>- 缩放平移 |
| `histogram_widget.py` | 直方图控件 | - 直方图绘制 |
| `graph_plot_widget.py` | 曲线图控件 | - 实时曲线<br>- 交互缩放 |
| `search_bar.py` | 搜索栏 | - 模糊搜索<br>- 过滤 |

### 3.5 对话框 (ui/dialogs/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `about_dialog.py` | 关于对话框 | - 版本信息 |
| `settings_dialog.py` | 设置对话框 | - 全局设置 |
| `export_dialog.py` | 导出对话框 | - 格式选择<br>- 导出选项 |
| `rename_dialog.py` | 重命名对话框 | - 节点重命名 |
| `node_search_dialog.py` | 节点搜索对话框 | - 快速创建节点 |

### 3.6 主题系统 (ui/themes/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `theme_manager.py` | 主题管理器 | - 主题加载<br>- 主题切换 |
| `style_sheet.py` | QSS生成器 | - QSS动态生成 |
| `colors.py` | 颜色常量 | - 配色方案 |

---

## 4. 工具模块 (utils/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `logger.py` | 日志工具 | - 日志配置<br>- 格式化 |
| `signals.py` | 全局信号总线 | - 信号定义<br>- 事件广播 |
| `math_utils.py` | 数学工具 | - 几何计算<br>- 插值 |
| `tensor_utils.py` | 张量工具 | - 形状推导<br>- 张量操作 |
| `file_utils.py` | 文件工具 | - 路径处理<br>- 文件操作 |
| `platform_utils.py` | 平台适配 | - 跨平台兼容 |

---

## 5. 插件模块 (plugins/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `plugin_base.py` | 插件基类 | - 插件接口定义 |
| `plugin_manager.py` | 插件管理器 | - 插件加载/卸载<br>- 依赖解析 |
| `plugin_registry.py` | 插件注册表 | - 插件索引 |

---

## 6. 配置模块 (config/)

| 文件 | 职责 | 关键实现 |
|------|------|---------|
| `settings.py` | 全局设置 | - 设置读写<br>- 默认值 |
| `default_settings.json` | 默认配置 | - 配置模板 |
| `keybindings.py` | 快捷键绑定 | - 快捷键管理 |
| `themes/dark.json` | 深色主题 | - 深色配色 |
| `themes/light.json` | 浅色主题 | - 浅色配色 |

---

## 7. 入口文件

| 文件 | 职责 |
|------|------|
| `main.py` | 程序入口，初始化应用 |
| `requirements.txt` | Python依赖列表 |
| `setup.py` | 安装脚本 |
| `README.md` | 项目说明 |
| `LICENSE` | 开源许可证 |

---

## 8. 文件统计

| 模块 | 文件数 | 代码行数（估计） |
|------|-------|----------------|
| core/base | 7 | ~2000 |
| core/nodes | 25+ | ~5000 |
| core/engine | 4 | ~1500 |
| core/expressions | 5 | ~1000 |
| core/serialization | 5 | ~800 |
| core/undo | 4 | ~600 |
| ui/graphics | 8 | ~3000 |
| ui/panels | 6 | ~2000 |
| ui/widgets | 9 | ~2500 |
| ui/dialogs | 5 | ~800 |
| ui/themes | 3 | ~500 |
| utils | 6 | ~1000 |
| plugins | 3 | ~500 |
| config | 5 | ~300 |
| **总计** | **95+** | **~22,000** |

---

*文档版本: v1.0*  
*最后更新: 2026-02-14*  
*文档状态: 已完成*